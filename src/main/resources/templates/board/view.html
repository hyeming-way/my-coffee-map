<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title th:text="${board.title}">Ë©≥Á¥∞„ÇíË¶ã„Çã</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link th:href="@{/css/main.css}" rel="stylesheet">
    <style>
	    .text-brown {
	        color: #8B4513; /* ÏßÑÌïú Í∞àÏÉâ */
	    }
	
	    .btn-outline-primary {
	        color: #8B4513;
	        border-color: #c8a974;
	    }
	
	    .btn-outline-primary:hover {
	        background-color: #c8a974;
	        border-color: #c8a974;
	        color: white;
	    }
	
	    .btn-outline-secondary {
	        color: #5c4435;
	        border-color: #c8a974;
	    }
	
	    .btn-outline-secondary:hover {
	        background-color: #c8a974;
	        border-color: #c8a974;
	        color: white;
	    }
	
	    .btn-danger {
	        background-color: #d86a6a;
	        border-color: #d86a6a;
	    }
	
	    .btn-danger:hover {
	        background-color: #b34f4f;
	        border-color: #b34f4f;
	    }
	
	    .btn-outline-danger {
	        color: #d86a6a;
	        border-color: #d86a6a;
	    }
	
	    .btn-outline-danger:hover {
	        background-color: #d86a6a;
	        color: white;
	    }
	
	    .card-body h6.card-title {
	        color: #5c4435;
	    }
	
	    .card.bg-light {
	        background-color: #f9f6f0 !important;
	    }
	
	    textarea.form-control {
	        border-radius: 6px;
	        border-color: #c8a974;
	    }
	
	    textarea.form-control:focus {
	        box-shadow: 0 0 0 0.2rem rgba(200, 169, 116, 0.25);
	        border-color: #c8a974;
	    }
	
	    .fw-bold {
	        color: #5c4435;
	    }
	
	    .btn-sm {
	        font-size: 0.85rem;
	        padding: 0.25rem 0.5rem;
	    }
	
	    .img-fluid.rounded {
	        border: 1px solid #e3d6c5;
	        box-shadow: 0 2px 4px rgba(139, 69, 19, 0.1);
	    }
	</style>
</head>

<div layout:fragment="content">
    <div class="container mt-5" style="max-width: 800px;">
        <h3 class="mb-3" th:text="${board.title}">„Çø„Ç§„Éà„É´</h3>

        <!-- ÏûëÏÑ±Ïûê Ï†ïÎ≥¥ -->
        <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="d-flex align-items-center">
                <img th:src="${board.user.profileImg != null} ? @{'/profiles/' + ${board.user.profileImg}} : @{/images/icon/basic_profile.jpg}"
                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;" alt="„Éó„É≠„Éï„Ç£„Éº„É´">
                <span class="ms-2 fw-bold" th:text="${board.user.nick + ' „Åï„Çì'}">„Éã„ÉÉ„ÇØ„Éç„Éº„É†</span>
            </div>

            <!-- ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº: ÏûëÏÑ±Ïûê Î≥∏Ïù∏Ïùº Í≤ΩÏö∞Îßå ÌëúÏãú -->
			<div th:if="${session.user != null and session.user.id == board.user.id}" class="mt-3">
			    <a th:href="@{/board/edit/{id}(id=${board.id})}" class="btn btn-sm btn-outline-primary me-2">‚úèÔ∏è Á∑®ÈõÜ</a>
			
			    <form th:action="@{/board/delete/{id}(id=${board.id})}" method="post" th:object="${board}" style="display:inline;">
			        <button type="submit" class="btn btn-sm btn-outline-danger"
			                onclick="return confirm('Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü');">üóëÔ∏è ÂâäÈô§</button>
			    </form>
			</div>
        </div>

        <div class="mb-3 text-muted small" th:text="${#temporals.format(board.createdAt, 'yyyy.MM.dd HH:mm')}">ÊäïÁ®øÊó•</div>

        <!-- Ï≤®Î∂Ä Ïù¥ÎØ∏ÏßÄ -->
        <img th:src="@{/boards/{filename}(filename=${board.imageUrl})}"
		     class="img-fluid rounded" alt="Ê∑ª‰ªòÁîªÂÉè"
		     style="max-height: 400px; object-fit: contain; display: block; margin: 0 auto;"
		     onerror="this.src='/images/default.png'" />


        <!-- Î≥∏Î¨∏ -->
        <div class="mb-4" th:text="${board.content}">Êú¨Êñá</div>

		<!-- Í¥ÄÎ†® Ï†ïÎ≥¥ ÏòÅÏó≠ -->
		<div class="mb-4">
		    <div class="card bg-light border-0 shadow-sm">
		        <div class="card-body">
		            <h6 class="card-title fw-bold mb-3">Èñ¢ÈÄ£ÊÉÖÂ†±</h6>
		
		            <!-- Í¥ÄÎ†® ÏõêÎëê -->
		            <div th:if="${board.bean != null}" class="mb-2 d-flex align-items-center">
		                <i class="bi bi-cup-straw me-2 text-brown"></i>
		                <span class="fw-bold">Èñ¢ÈÄ£„Ç≥„Éº„Éí„ÉºË±ÜÔºö</span>
		                <span class="ms-1 text-muted" th:text="${board.bean.name + 'Ôºà' + board.bean.origin + 'Ôºâ'}">„Ç≥„Éº„Éí„ÉºË±ÜÂêç</span>
		            </div>
		
		            <!-- Í¥ÄÎ†® Ïπ¥Ìéò -->
		            <div th:if="${board.cafe != null}" class="d-flex align-items-center">
		                <i class="bi bi-geo-alt-fill me-2 text-danger"></i>
		                <span class="fw-bold">Èñ¢ÈÄ£„Ç´„Éï„ÇßÔºö</span>
		                <span class="ms-1 text-muted" th:text="${board.cafe.name + 'Ôºà' + board.cafe.address + 'Ôºâ'}">„Ç´„Éï„ÇßÂêç</span>
		            </div>
		        </div>
		    </div>
		</div>

         <!-- Î≥ÑÏ†ê -->
        <div class="mb-3">
            <strong>Ë©ï‰æ°Ôºö</strong>
            <span th:each="i : ${#numbers.sequence(1, 5)}">
                <i class="bi" th:classappend="${i <= board.rating} ? 'bi-star-fill text-warning' : 'bi-star text-secondary'"></i>
            </span>
        </div>

        <!-- Ï¢ãÏïÑÏöî ÏòÅÏó≠ -->
		<div class="mb-4">
		    <div class="d-flex align-items-center">
		        <!-- Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú: Ï¢ãÏïÑÏöî Î≤ÑÌäº (ÌÜ†Í∏Ä) -->
		        <form th:if="${session.user != null}" 
		              th:action="@{/board/like}" 
		              method="post" class="me-2 mb-0">
		            <input type="hidden" name="boardId" th:value="${board.id}" />
		            <button type="submit" class="btn btn-sm p-0 border-0 bg-transparent">
		                <i class="bi bi-heart-fill fs-4"
		                   th:classappend="${liked} ? 'text-danger' : 'text-secondary'"></i>
		            </button>
		        </form>
		
		        <!-- ÎπÑÎ°úÍ∑∏Ïù∏ ÏÉÅÌÉú: Îã®Ïàú ÌïòÌä∏ ÌëúÏãú -->
		        <div th:if="${session.user == null}" class="me-2">
		            <i class="bi bi-heart-fill fs-4"
		               th:classappend="${likeCount > 0} ? 'text-danger' : 'text-secondary'"></i>
		        </div>
		
		        <!-- Ï¢ãÏïÑÏöî Ïàò Ï∂úÎ†• -->
		        <div class="text-muted small" th:text="${likeCount + ' „ÅÑ„ÅÑ„Å≠ÔºÅ'}">0 „ÅÑ„ÅÑ„Å≠ÔºÅ</div>
		    </div>
		
		    <!-- ÎπÑÎ°úÍ∑∏Ïù∏ ÏïàÎÇ¥Î¨∏ -->
		    <div th:if="${session.user == null}" class="text-muted small mt-1">
		        ‚Äª„É≠„Ç∞„Ç§„É≥Âæå„Äå„ÅÑ„ÅÑ„Å≠ÔºÅ„Äç„Åß„Åç„Åæ„Åô„ÄÇ
		    </div>
		</div>

        <!-- ÎåìÍ∏Ä Î™©Î°ù -->
		<div class="mt-4">
		    <h6>„Ç≥„É°„É≥„Éà</h6>
		    <div th:each="comment : ${comments}" class="comment-box mb-3 p-2 border rounded">
		        <!-- ÎãâÎÑ§ÏûÑ + ÎåìÍ∏ÄÎÇ¥Ïö© -->
		        <p class="mb-1">
		            <strong th:text="${comment.user.nick}"></strong>
		
		            <!-- ÏàòÏ†ï Ìèº -->
		            <form th:if="${session.user != null and editingCommentId == comment.id}" 
		                  th:action="@{/comment/edit}" method="post" class="d-inline w-100">
		                <input type="hidden" name="commentId" th:value="${comment.id}" />
		                <input type="hidden" name="boardId" th:value="${board.id}" />
		                <textarea name="content" class="form-control mb-1" rows="2" required 
		                          th:text="${comment.content}"></textarea>
		                <button type="submit" class="btn btn-sm btn-outline-primary me-1">‰øùÂ≠ò</button>
		                <a th:href="@{/board/{id}(id=${board.id})}" class="btn btn-sm btn-outline-secondary">„Ç≠„É£„É≥„Çª„É´</a>
		            </form>
		
		            <!-- ÏùºÎ∞ò ÌëúÏãú -->
		            <span th:if="${editingCommentId != comment.id}" th:text="${comment.content}"></span>
		        </p>
		
				<!-- ÎÉáÍ∏Ä ÏûÖÎ†•ÏùºÏûê / ÏàòÏ†ïÏùºÏûê -->
		        <small>
				    <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
				    
				    <span th:if="${comment.updatedAt != null and comment.updatedAt != comment.createdAt}" class="text-muted small">
				        ‚úèÔ∏è Á∑®ÈõÜ: 
				        <span th:text="${#temporals.format(comment.updatedAt, 'yyyy-MM-dd HH:mm')}"></span>
				    </span>
				</small>
		
		        <!-- ÏàòÏ†ï/ÏÇ≠Ï†ú Î≤ÑÌäº (ÎåìÍ∏Ä ÏûëÏÑ±ÏûêÎßå ÏàòÏ†ï Í∞ÄÎä•) -->
		        <div class="mt-1">
		            <!-- ÎåìÍ∏Ä ÏûëÏÑ±Ïûê: ÏàòÏ†ï -->
		            <a th:if="${session.user != null and session.user.id == comment.user.id}" 
		               th:href="@{/board/{id}(id=${board.id}, edit=${comment.id})}"
		               class="btn btn-sm btn-outline-primary me-1">Á∑®ÈõÜ</a>
		
		            <!-- ÎåìÍ∏Ä ÏûëÏÑ±Ïûê ÎòêÎäî Í≤åÏãúÍ∏Ä ÏûëÏÑ±Ïûê: ÏÇ≠Ï†ú -->
		            <form th:if="${session.user != null and 
		                         (session.user.id == comment.user.id or session.user.id == board.user.id)}"
		                  th:action="@{/board/comment/{id}/delete(id=${comment.id})}" 
		                  method="post" style="display:inline;">
		                <button type="submit" class="btn btn-sm btn-outline-danger"
		                        onclick="return confirm('„Ç≥„É°„É≥„Éà„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü');">ÂâäÈô§</button>
		            </form>
		        </div>
		    </div>
		</div>
		
		<!-- ÎåìÍ∏Ä ÏûëÏÑ± -->
		<div class="mb-4">
		    <form th:action="@{'/board/' + ${board.id} + '/comment'}" method="post" th:if="${session.user != null}">
		        <textarea name="content" class="form-control mb-2" rows="2" placeholder="„Ç≥„É°„É≥„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" required></textarea>
		        <button type="submit" class="btn btn-outline-secondary btn-sm">ÊäïÁ®ø</button>
		    </form>
		    <div th:if="${session.user == null}" class="text-muted small">‚Äª„É≠„Ç∞„Ç§„É≥Âæå„Ç≥„É°„É≥„Éà„Åß„Åç„Åæ„Åô„ÄÇ</div>
		</div>

        <!-- Î™©Î°ùÏúºÎ°ú -->
        <div class="text-end mt-4 mb-5">
            <a th:href="@{/board/list}" class="btn btn-outline-secondary btn-sm">„É™„Çπ„Éà„Å´ÈÄ≤„ÇÄ</a>
        </div>
    </div>
</div>
</html>
