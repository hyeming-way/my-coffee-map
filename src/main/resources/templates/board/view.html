<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title th:text="${board.title}">è©³ç´°ã‚’è¦‹ã‚‹</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link th:href="@{/css/main.css}" rel="stylesheet">
    <style>
	    .text-brown {
	        color: #8B4513; /* ì§„í•œ ê°ˆìƒ‰ */
	    }
	
	    .btn-outline-primary {
	        color: #8B4513;
	        border-color: #c8a974;
	    }
	
	    .btn-outline-primary:hover {
	        background-color: #c8a974;
	        border-color: #c8a974;
	        color: white;
	    }
	
	    .btn-outline-secondary {
	        color: #5c4435;
	        border-color: #c8a974;
	    }
	
	    .btn-outline-secondary:hover {
	        background-color: #c8a974;
	        border-color: #c8a974;
	        color: white;
	    }
	
	    .btn-danger {
	        background-color: #d86a6a;
	        border-color: #d86a6a;
	    }
	
	    .btn-danger:hover {
	        background-color: #b34f4f;
	        border-color: #b34f4f;
	    }
	
	    .btn-outline-danger {
	        color: #d86a6a;
	        border-color: #d86a6a;
	    }
	
	    .btn-outline-danger:hover {
	        background-color: #d86a6a;
	        color: white;
	    }
	
	    .card-body h6.card-title {
	        color: #5c4435;
	    }
	
	    .card.bg-light {
	        background-color: #f9f6f0 !important;
	    }
	
	    textarea.form-control {
	        border-radius: 6px;
	        border-color: #c8a974;
	    }
	
	    textarea.form-control:focus {
	        box-shadow: 0 0 0 0.2rem rgba(200, 169, 116, 0.25);
	        border-color: #c8a974;
	    }
	
	    .fw-bold {
	        color: #5c4435;
	    }
	
	    .btn-sm {
	        font-size: 0.85rem;
	        padding: 0.25rem 0.5rem;
	    }
	
	    .img-fluid.rounded {
	        border: 1px solid #e3d6c5;
	        box-shadow: 0 2px 4px rgba(139, 69, 19, 0.1);
	    }
	</style>
</head>

<div layout:fragment="content">
    <div class="container mt-5" style="max-width: 800px;">
        <h3 class="mb-3" th:text="${board.title}">ã‚¿ã‚¤ãƒˆãƒ«</h3>

        <!-- ì‘ì„±ì ì •ë³´ -->
        <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="d-flex align-items-center">
                <img th:src="${board.user.profileImg != null} ? @{'/profiles/' + ${board.user.profileImg}} : @{/images/icon/basic_profile.jpg}"
                     style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;" alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«">
                <span class="ms-2 fw-bold" th:text="${board.user.nick + ' ã•ã‚“'}">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </span>
            </div>

            <!-- ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼: ì‘ì„±ì ë³¸ì¸ì¼ ê²½ìš°ë§Œ í‘œì‹œ -->
			<div th:if="${session.user != null and session.user.id == board.user.id}" class="mt-3">
			    <a th:href="@{/board/edit/{id}(id=${board.id})}" class="btn btn-sm btn-outline-primary me-2">âœï¸ ç·¨é›†</a>
			
			    <form th:action="@{/board/delete/{id}(id=${board.id})}" method="post" th:object="${board}" style="display:inline;">
			        <button type="submit" class="btn btn-sm btn-outline-danger"
			                onclick="return confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">ğŸ—‘ï¸ å‰Šé™¤</button>
			    </form>
			</div>
        </div>

        <div class="mb-3 text-muted small" th:text="${#temporals.format(board.createdAt, 'yyyy.MM.dd HH:mm')}">æŠ•ç¨¿æ—¥</div>

        <!-- ì²¨ë¶€ ì´ë¯¸ì§€ -->
        <img th:src="@{/boards/{filename}(filename=${board.imageUrl})}"
		     class="img-fluid rounded" alt="æ·»ä»˜ç”»åƒ"
		     style="max-height: 400px; object-fit: contain; display: block; margin: 0 auto;"
		     onerror="this.src='/images/default.png'" />


        <!-- ë³¸ë¬¸ -->
        <div class="mb-4" th:text="${board.content}">æœ¬æ–‡</div>

		<!-- ê´€ë ¨ ì •ë³´ ì˜ì—­ -->
		<div class="mb-4">
		    <div class="card bg-light border-0 shadow-sm">
		        <div class="card-body">
		            <h6 class="card-title fw-bold mb-3">é–¢é€£æƒ…å ±</h6>
		
		            <!-- ê´€ë ¨ ì›ë‘ -->
		            <div th:if="${board.bean != null}" class="mb-2 d-flex align-items-center">
		                <i class="bi bi-cup-straw me-2 text-brown"></i>
		                <span class="fw-bold">é–¢é€£ã‚³ãƒ¼ãƒ’ãƒ¼è±†ï¼š</span>
		                <span class="ms-1 text-muted" th:text="${board.bean.name + 'ï¼ˆ' + board.bean.origin + 'ï¼‰'}">ã‚³ãƒ¼ãƒ’ãƒ¼è±†å</span>
		            </div>
		
		            <!-- ê´€ë ¨ ì¹´í˜ -->
		            <div th:if="${board.cafe != null}" class="d-flex align-items-center">
		                <i class="bi bi-geo-alt-fill me-2 text-danger"></i>
		                <span class="fw-bold">é–¢é€£ã‚«ãƒ•ã‚§ï¼š</span>
		                <span class="ms-1 text-muted" th:text="${board.cafe.name + 'ï¼ˆ' + board.cafe.address + 'ï¼‰'}">ã‚«ãƒ•ã‚§å</span>
		            </div>
		        </div>
		    </div>
		</div>

         <!-- ë³„ì  -->
        <div class="mb-3">
            <strong>è©•ä¾¡ï¼š</strong>
            <span th:each="i : ${#numbers.sequence(1, 5)}">
                <i class="bi" th:classappend="${i <= board.rating} ? 'bi-star-fill text-warning' : 'bi-star text-secondary'"></i>
            </span>
        </div>

        <!-- ì¢‹ì•„ìš” ì˜ì—­ -->
		<div class="mb-4">
		    <div class="d-flex align-items-center">
		        <!-- ë¡œê·¸ì¸ ìƒíƒœ: ì¢‹ì•„ìš” ë²„íŠ¼ (í† ê¸€) -->
		        <form th:if="${session.user != null}" 
		              th:action="@{/board/like}" 
		              method="post" class="me-2 mb-0">
		            <input type="hidden" name="boardId" th:value="${board.id}" />
		            <button type="submit" class="btn btn-sm p-0 border-0 bg-transparent">
		                <i class="bi bi-heart-fill fs-4"
		                   th:classappend="${liked} ? 'text-danger' : 'text-secondary'"></i>
		            </button>
		        </form>
		
		        <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ: ë‹¨ìˆœ í•˜íŠ¸ í‘œì‹œ -->
		        <div th:if="${session.user == null}" class="me-2">
		            <i class="bi bi-heart-fill fs-4"
		               th:classappend="${likeCount > 0} ? 'text-danger' : 'text-secondary'"></i>
		        </div>
		
		        <!-- ì¢‹ì•„ìš” ìˆ˜ ì¶œë ¥ -->
		        <div class="text-muted small" th:text="${likeCount + ' ã„ã„ã­ï¼'}">0 ã„ã„ã­ï¼</div>
		    </div>
		
		    <!-- ë¹„ë¡œê·¸ì¸ ì•ˆë‚´ë¬¸ -->
		    <div th:if="${session.user == null}" class="text-muted small mt-1">
		        â€»ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€Œã„ã„ã­ï¼ã€ã§ãã¾ã™ã€‚
		    </div>
		</div>

        <!-- ëŒ“ê¸€ ëª©ë¡ -->
		<div class="mt-4">
		    <h6>ã‚³ãƒ¡ãƒ³ãƒˆ</h6>
		    <div th:each="comment : ${comments}" class="comment-box mb-3 p-2 border rounded">
		        <!-- ë‹‰ë„¤ì„ + ëŒ“ê¸€ë‚´ìš© -->
		        <p class="mb-1">
		            <strong th:text="${comment.user.nick}"></strong>
		
		            <!-- ìˆ˜ì • í¼ -->
		            <form th:if="${session.user != null and editingCommentId == comment.id}" 
		                  th:action="@{/comment/edit}" method="post" class="d-inline w-100">
		                <input type="hidden" name="commentId" th:value="${comment.id}" />
		                <input type="hidden" name="boardId" th:value="${board.id}" />
		                <textarea name="content" class="form-control mb-1" rows="2" required 
		                          th:text="${comment.content}"></textarea>
		                <button type="submit" class="btn btn-sm btn-outline-primary me-1">ä¿å­˜</button>
		                <a th:href="@{/board/{id}(id=${board.id})}" class="btn btn-sm btn-outline-secondary">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</a>
		            </form>
		
		            <!-- ì¼ë°˜ í‘œì‹œ -->
		            <span th:if="${editingCommentId != comment.id}" th:text="${comment.content}"></span>
		        </p>
		
				<!-- ëƒ‡ê¸€ ì…ë ¥ì¼ì / ìˆ˜ì •ì¼ì -->
		        <small>
				    <span th:text="${#temporals.format(comment.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
				    
				    <span th:if="${comment.updatedAt != null and comment.updatedAt != comment.createdAt}" class="text-muted small">
				        âœï¸ ç·¨é›†: 
				        <span th:text="${#temporals.format(comment.updatedAt, 'yyyy-MM-dd HH:mm')}"></span>
				    </span>
				</small>
		
		        <!-- ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ (ëŒ“ê¸€ ì‘ì„±ìë§Œ ìˆ˜ì • ê°€ëŠ¥) -->
		        <div class="mt-1">
		            <!-- ëŒ“ê¸€ ì‘ì„±ì: ìˆ˜ì • -->
		            <a th:if="${session.user != null and session.user.id == comment.user.id}" 
		               th:href="@{/board/{id}(id=${board.id}, edit=${comment.id})}"
		               class="btn btn-sm btn-outline-primary me-1">ç·¨é›†</a>
		
		            <!-- ëŒ“ê¸€ ì‘ì„±ì ë˜ëŠ” ê²Œì‹œê¸€ ì‘ì„±ì: ì‚­ì œ -->
		            <form th:if="${session.user != null and 
		                         (session.user.id == comment.user.id or session.user.id == board.user.id)}"
		                  th:action="@{/board/comment/{id}/delete(id=${comment.id})}" 
		                  method="post" style="display:inline;">
		                <button type="submit" class="btn btn-sm btn-outline-danger"
		                        onclick="return confirm('ã‚³ãƒ¡ãƒ³ãƒˆã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">å‰Šé™¤</button>
		            </form>
		        </div>
		    </div>
		</div>
		
		<!-- ëŒ“ê¸€ ì‘ì„± -->
		<div class="mb-4">
		    <form th:action="@{'/board/' + ${board.id} + '/comment'}" method="post" th:if="${session.user != null}">
		        <textarea name="content" class="form-control mb-2" rows="2" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„" required></textarea>
		        <button type="submit" class="btn btn-outline-secondary btn-sm">æŠ•ç¨¿</button>
		    </form>
		    <div th:if="${session.user == null}" class="text-muted small">â€»ãƒ­ã‚°ã‚¤ãƒ³å¾Œã‚³ãƒ¡ãƒ³ãƒˆã§ãã¾ã™ã€‚</div>
		</div>

        <!-- ëª©ë¡ìœ¼ë¡œ -->
        <div class="text-end mt-4 mb-5">
            <a th:href="@{/board/list}" class="btn btn-outline-secondary btn-sm">ãƒªã‚¹ãƒˆã«é€²ã‚€</a>
        </div>
    </div>
</div>
</html>
