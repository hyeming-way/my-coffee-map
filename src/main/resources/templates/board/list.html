<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">

<!-- HEAD ì˜ì—­ -->
<th:block layout:fragment="head">
    <title>ã‚³ãƒ¼ãƒ’ãƒ¼ãƒãƒ¼ãƒˆãƒªã‚¹ãƒˆ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link th:href="@{/css/main.css}" rel="stylesheet">

    <style>
        .card {
            border: 1px solid #CBB68F;
            transition: transform 0.2s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .pagination .page-link {
            background-color: #DDB892;
            border: none;
            color: #fff;
        }
        .pagination .page-link:hover {
            background-color: #b58b65;
        }
        .pagination .active .page-link {
            background-color: #A97451;
            color: #fff;
        }
        .rating .bi {
            color: #ffc107;
            font-size: 1rem;
        }
        .btn-coffee {
	        background-color: #CBB68F;
	        border: none;
	        color: #fff;
	    }
	
	    .btn-coffee:hover {
	        background-color: #a88e65;
	        color: #fff;
	    }
    </style>
</th:block>

<!-- CONTENT ì˜ì—­ -->
<div layout:fragment="content">
    <div class="container mt-5 mb-5">
        <h3 class="mb-4">ã‚³ãƒ¼ãƒ’ãƒ¼ãƒãƒ¼ãƒˆ ğŸ“š</h3>

        <!-- ê²€ìƒ‰ í¼ -->
        <form th:action="@{/board/list}" method="get" class="row mb-4 g-2 align-items-end">
            <div class="col-md-4">
                <label class="form-label fw-bold">ã‚³ãƒ¼ãƒ’ãƒ¼è±†ã§æ¤œç´¢</label>
                <select class="form-select" name="beanId">
                    <option th:value="' '" th:selected="${beanId == null}">ã™ã¹ã¦ã®è±†</option>
                    <option th:each="bean : ${beanList}"
                            th:value="${bean.id}"
                            th:text="${bean.name}"
                            th:selected="${bean.id == beanId}">ã‚³ãƒ¼ãƒ’ãƒ¼è±†</option>
                </select>
            </div>
            <div class="col-md-4">
                <label class="form-label fw-bold">ã‚«ãƒ•ã‚§ã§æ¤œç´¢</label>
                <select class="form-select" name="cafeId">
                    <option th:value="' '" th:selected="${cafeId == null}">ã™ã¹ã¦ã®ã‚«ãƒ•ã‚§</option>
                    <option th:each="cafe : ${cafeList}"
                            th:value="${cafe.id}"
                            th:text="${cafe.name}"
                            th:selected="${cafe.id == cafeId}">ã‚«ãƒ•ã‚§</option>
                </select>
            </div>
            
            <!-- ê²€ìƒ‰ ë²„íŠ¼ + ì „ì²´ ë¦¬ìŠ¤íŠ¸ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
			<div class="col-md-4 d-flex gap-2">
			    <button type="submit" class="btn btn-sm w-50"
			        style="background-color: #cbb68f; border: none; color: #fff;">
			        ğŸ” æ¤œç´¢
			    </button>
			
			    <a th:href="@{/board/list}"
			       th:if="${beanId != null or cafeId != null}"
			       class="btn btn-sm w-50"
			       style="background-color: #eee0c9; border: none; color: #5c3b1e;">
			        ğŸ” ãƒªã‚»ãƒƒãƒˆ
			    </a>
			</div>
        </form>

        <!-- ê²Œì‹œê¸€ ì¹´ë“œ ëª©ë¡ -->
        <div class="row row-cols-1 row-cols-md-3 g-4">
            <div class="col" th:each="board : ${boardPage.content}">
                <div class="card h-100 shadow-sm position-relative">
                    <!-- ì´ë¯¸ì§€ ì¶œë ¥ -->
                    <img th:if="${board.imageUrl != null}"
                         th:src="@{/boards/{filename}(filename=${board.imageUrl})}"
                         class="card-img-top"
                         style="height: 180px; object-fit: cover;"
                         onerror="this.src='/images/default.png'"
                         alt="ç”»åƒ" />

                    <div class="card-body">
                        <h5 class="card-title" th:text="${board.title}">ã‚¿ã‚¤ãƒˆãƒ«</h5>
                        <p class="card-text" th:text="${#strings.abbreviate(board.content, 80)}">å†…å®¹ã®è¦ç´„</p>

                        <!-- ë³„ì  -->
                        <div class="rating mt-2">
                            <i class="bi" th:each="i : ${#numbers.sequence(1, 5)}"
                               th:classappend="${i <= board.rating} ? 'bi-star-fill' : 'bi-star'"></i>
                        </div>
                    </div>

                    <!-- ì¹´ë“œ í•˜ë‹¨ -->
					<div class="card-footer small text-muted d-flex justify-content-between align-items-center">
					    
					    <!-- ì™¼ìª½: í”„ë¡œí•„ + ë‹‰ë„¤ì„ + ì‘ì„±ì¼/ìˆ˜ì •ì¼ -->
					    <div class="d-flex align-items-center gap-2">
					        <img th:src="${board.user.profileImg != null} ? @{'/profiles/' + ${board.user.profileImg}} : @{/images/icon/basic_profile.jpg}"
					             class="rounded-circle"
					             style="width: 30px; height: 30px; object-fit: cover;"
					             alt="ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ" />
					        <div>
					            <div th:text="${board.user.nick}">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </div>
					            <div class="text-muted small">
					                <span th:text="${#temporals.format(board.createdAt, 'yyyy.MM.dd')} + ' ä½œæˆ'"></span>
					                <span th:if="${board.updatedAt != null and board.updatedAt != board.createdAt}"
					                      th:text="' / ' + ${#temporals.format(board.updatedAt, 'yyyy.MM.dd')} + ' ä¿®æ­£'"></span>
					            </div>
					        </div>
					    </div>
					
					    <!-- ì˜¤ë¥¸ìª½: ì¢‹ì•„ìš” -->
					    <div class="text-danger d-flex align-items-center gap-1">
					        <i class="bi bi-heart-fill"></i>
					        <span th:text="${board.likeCount}">0</span>
					    </div>
					</div>

                    <!-- ìƒì„¸ í˜ì´ì§€ ë§í¬ -->
                    <a class="stretched-link" th:href="@{'/board/' + ${board.id}}"></a>
                </div>
            </div>
        </div>

        <!-- í˜ì´ì§€ê°€ 1ê°œ ì´ìƒì¼ ë•Œë§Œ í˜ì´ì§€ë„¤ì´ì…˜ í‘œì‹œ -->
		<div class="mt-4 d-flex justify-content-center" th:if="${boardPage.totalPages > 0}">
		    <nav>
		        <ul class="pagination pagination-sm">
		            <!-- ì´ì „ ë²„íŠ¼ -->
		            <li class="page-item" th:classappend="${boardPage.first} ? 'disabled'">
		                <a class="page-link"
		                   th:href="@{'/board/list?page=' + ${boardPage.number - 1} + ${@urlUtil.buildQueryParams(beanId, cafeId)} }">Â«</a>
		            </li>
		
		            <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
		            <li class="page-item" th:each="i : ${#numbers.sequence(0, boardPage.totalPages - 1)}"
		                th:classappend="${boardPage.number == i} ? 'active'">
		                <a class="page-link"
		                   th:href="@{'/board/list?page=' + ${i} + ${@urlUtil.buildQueryParams(beanId, cafeId)} }"
		                   th:text="${i + 1}">1</a>
		            </li>
		
		            <!-- ë‹¤ìŒ ë²„íŠ¼ -->
		            <li class="page-item" th:classappend="${boardPage.last} ? 'disabled'">
		                <a class="page-link"
		                   th:href="@{'/board/list?page=' + ${boardPage.number + 1} + ${@urlUtil.buildQueryParams(beanId, cafeId)} }">Â»</a>
		            </li>
		        </ul>
		    </nav>
		</div>	    

        <!-- ë©”ì¸í™”ë©´ ë²„íŠ¼ -->
        <div class="text-end mt-5">
            <a th:href="@{/mycoffeemap}" class="btn btn-sm"
               style="border: 1px solid #CBB68F; color: #000;">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </div>
    </div>
</div>

</html>
